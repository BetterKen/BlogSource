---
title: HTTP2和3
date: 2020-04-13 19:45:00
tags:
    - 网络
    - HTTP
categories:
    - 基础
    - 网络
---

## 1 HTTP/1.1遇到的问题

- **高延时**
  - **并发连接有限**
  - **同一连接同时只能在完成一个 HTTP 事务（请求/响应）才能处理下一个事务**
- **重复传输的体积巨大的 HTTP 头部**
- **不支持服务器推送消息**



## 2 HTTP2

### 2.1 HTTP2的由来

**早期的SPDY演化而来**

 **HTTP 协议取消了小版本号，所以 HTTP/2 的正式名字不是 2.0而是HTTP/2；**

### 2.2 特性

- **兼容HTTP/1.x,保留了请求方法、URI 等传统概念**

- **数据量大幅减少**
  - **使用“HPACK”算法压缩头部信息，消除冗余数据节约带宽**
  - **消息不再是“Header+Body”的形式，而是分散为多个二进制“帧”**

- **使用虚拟的“流”传输消息，在应用解决了困扰多年的“队头阻塞”问题，同时实现了“多路复用”，提高连接的利用率**

- **服务器消息推送**

  

### 2.3 核心概念

- **连接 Connection**：1个 TCP 连接，包含一个 或者多个 Stream
- **数据流 Stream**：一个双向通讯数据流，包含 1 条或者多条 Message
- **消息 Message**：对应 HTTP/1 中的请求或者响应，包含一条或者多条 Frame
- **数据帧 Frame**：最小单位，以二进制压缩格 式存放 HTTP/1 中的内容

![](http://base422.oss-cn-beijing.aliyuncs.com/neth2core.png)



### 2.4 h2和h2c

为了区分“加密”和“明文”这两个不同的版本，HTTP/2 协议定义了两个字符串标识符：

- “h2”表示加密的 HTTP/2,有TLS安全套件
- “h2c”表示明文的 HTTP/2，多出的那个字母“c”的意思是“clear text”。

## 3 HTTP3

### 3.1 HTTP/2 的队头阻塞

让我们从协议栈的角度来仔细看一下。在 HTTP/2 把多个“请求 - 响应”分解成流，交给TCP 后，TCP 会再拆成更小的包依次发送（其实在 TCP 里应该叫 segment，也就是“段”）。
在网络良好的情况下，包可以很快送达目的地。但如果网络质量比较差，像手机上网的时候，就有可能会丢包。而 TCP 为了保证可靠传输，有个特别的“丢包重传”机制，丢失的包必须要等待重新传输确认，其他的包即使已经收到了，也只能放在缓冲区里，上层的应用拿不出来，只能“干着急"



### 3.2 QUIC

Google 在推 SPDY 的时候就已经意识到了这个问题，于是就又发明了一个新的“QUIC”协议，让 HTTP 跑在 QUIC 上而不是 TCP 上。

而这个“HTTP over QUIC”就是 HTTP 协议的下一个大版本，HTTP/3。它在 HTTP/2 的基础上又实现了质的飞跃，真正“完美”地解决了“队头阻塞”问题。
**不过 HTTP/3 目前还处于草案阶段!**



### 3.3 QUCI特性


- QUIC 是一个新的传输层协议，建立在 **UDP 之上，实现了可靠传输**
- QUIC 内含了 TLS1.3，只能加密通信，支持 0-RTT 快速建连；
- QUIC 的连接使用“不透明”的连接 ID，不绑定在“IP 地址 + 端口”上，支持“连接迁移”；
- QUIC 的流与 HTTP/2 的流很相似，但分为双向流和单向流；
- HTTP/3 没有指定默认端口号，需要用 HTTP/2 的扩展帧“Alt-Svc”来发现。



## 4 HTTP版本比较

![](http://base422.oss-cn-beijing.aliyuncs.com/netquic.png)

