---
title: HTTPS和TLS
date: 2020-04-13 19:42:00
tags:
    - 网络
    - HTTP
categories:
    - 基础
    - 网络
---

## 1 为什么要有HTTPS

**因为HTTP不安全！**

由于 HTTP 天生“明文”的特点，整个传输过程完全透明，任何人都能够在链路中截获、修改或者伪造请求 / 响应报文，数据不具有可信性。



## 2 什么是安全的通信

通常认为如果通信过程具备了四个特性，就可以认为是“安全”的，这四个特性是：

- **保密性**
- **完整性**
- **身份认证**

而HTTPS则实现了这三个特性,原因在于它的"S"===> SSL/TLS协议

![](http://base422.oss-cn-beijing.aliyuncs.com/netssl.jpg)



**SSL 是 “Secure Sockets Layer” 的缩写，中文意思为“安全套接层”，所以说明－－戴套更安全～**

## 3 SSL/TLS协议
### 3.1 设计的目的

- **保密性**
- **完整性**
- **身份认证**

### 3.2 版本

**一开始叫SSL,后来更名为TLS,目前的版本号是TLS1.3**

![](http://base422.oss-cn-beijing.aliyuncs.com/nettls.png)

### 3.3 对称加密

“对称加密”很好理解，就是指加密和解密时使用的密钥都是同一个，是“对称”的。只要保证了密钥的安全，那整个通信过程就可以说具有了机密性。
举个例子，你想要登录某网站，只要事先和它约定好使用一个对称密码，通信过程中传输的全是用密钥加密后的密文，只有你和网站才能解密。黑客即使能够窃听，看到的也只是乱码，因为没有密钥无法解出明文，所以就实现了机密性。

![](http://base422.oss-cn-beijing.aliyuncs.com/netdcjm.png)

**常用的对称加密算法为AES算法**

AES 的意思是“高级加密标准”（Advanced Encryption Standard），密钥长度可以是128、192 或 256。它是 DES 算法的替代者，安全强度很高，性能也很好，而且有的硬件还会做特殊优化，所以非常流行，是应用最广泛的对称加密算法。

### 3.4 非对称加密

对称加密看上去好像完美地实现了机密性，但其中有一个很大的问题：如何把密钥安全地传递给对方，术语叫“密钥交换”。

**此时就出现了非对称加密（也叫公钥加密算法）。它有两个密钥，一个叫“公钥”（public key），一个叫“私钥”（private key）。**

两个密钥是不同的，“不对称”，公钥可以公开给任何人使用，而私钥必须严格保密。公钥和私钥有个特别的“单向”性，虽然都可以用来加密解密，但公钥加密后只能用私钥解密，反过来，私钥加密后也只能用公钥解密。

非对称加密可以解决“密钥交换”的问题。网站秘密保管私钥，在网上任意分发公钥，你想要登录网站只要用公钥加密就行了，密文只能由私钥持有者才能解密。而黑客因为没有私钥，所以就无法破解密文。

![](http://base422.oss-cn-beijing.aliyuncs.com/netfdc.png)



**常用的非对称加密算法为RSA算法,后起之秀是基于椭圆曲线的ECDH协议**

### 3.5 混合加密

**现在 TLS 里使用的混合加密方式**，其实说穿了也很简单：

- 在通信刚开始的时候**使用非对称算法**，比如 RSA、ECDH，首先**解决密钥交换**的问题。
- 然后用随机数产生对称算法使用的“会话密钥”（session key），再用公钥加密。因为会话密钥很短，通常只有 16 字节或 32 字节，所以慢一点也无所谓。
- 对方拿到密文后用私钥解密，取出会话密钥。这样，双方就实现了对称密钥的安全交换，后续就不再使用非对称加密，全都使用对称加密。



### 3.6 数字签名

- 基于私钥加密，只能使用公钥解密：起到身份认证的使用
- 公钥的管理：Public Key Infrastructure（PKI）公钥基础设施
  - 由 Certificate Authority（CA）数字证书认证机构将用户个人身份与公开密钥关联在一起
  - 公钥数字证书组成
    - CA 信息、公钥用户信息、公钥、权威机构的签字、有效期
  - PKI 用户
    - 向 CA 注册公钥的用户
    - 希望使用已注册公钥的用户

### 3.6.1 签发证书的流程

![](http://base422.oss-cn-beijing.aliyuncs.com/netcert.png)

#### 3.6.2 签名和验签流程

![](http://base422.oss-cn-beijing.aliyuncs.com/netsign.png)

#### 3.6.3 PKI公钥基础设施

![](http://base422.oss-cn-beijing.aliyuncs.com/netpki.png)



## 3.7 TLS1.3和TLS1.2对比

- 相比过去的的版本，引入了新的密钥协商机制 — PSK
- 支持 0-RTT 数据传输，在建立连接时节省了往返时间
- 废弃了 3DES、RC4、AES-CBC 等加密组件，废弃了 SHA1、MD5 等哈希算法
- ServerHello 之后的所有握手消息采取了加密操作，可见明文大大减少
- 不再允许对加密报文进行压缩、不再允许双方发起重协商
- DSA 证书不再允许在 TLS 1.3 中使用

#### 3.7.1 更快的访问速度

初始建立TLS连接时TLS1.2需要两次RTT,而TLS1.3则需要一次RTT

![](http://base422.oss-cn-beijing.aliyuncs.com/nettlsrtt.png)

再次建立连接时,基于**session ticket**,**TLS1.2需要一次RTT,而TLS1.3则需要0次RTT**

#### 3.7.2 更强安全性

TLS 1.3 在之前版本的基础上删除了那些不安全的加密算法，这些加密算法包括：

- RSA 密钥传输 —— 不支持前向安全性
- CBC 模式密码 —— 易受 BEAST 和 Lucky 13 攻击
- RC4 流密码 —— 在 HTTPS 中使用并不安全
- SHA-1 哈希函数 —— 建议以 SHA-2 取而代之
- 任意 Diffie-Hellman 组—— CVE-2016-0701 漏洞
- 输出密码 —— 易受 FREAK 和 LogJam 攻击

